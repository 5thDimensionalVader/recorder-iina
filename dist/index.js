!function(){function e(e,t,n,r,i,o,a){try{var s=e[o](a),l=s.value}catch(e){n(e);return}s.done?t(l):Promise.resolve(l).then(r,i)}"function"==typeof SuppressedError&&SuppressedError;var t=iina.core,n=iina.mpv,r=iina.utils,i=iina.overlay,o=iina.preferences,a=iina.console;function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"15px",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3e3;i.simpleMode(),i.setContent(`<p>${e}</p>`),i.setStyle(`p { color: ${n?"red":"green"}; font-size: ${t}; margin-top: 40px;}`),i.show(),setTimeout(function(){i.hide()},r)}function l(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.postMessage("ffmpeg-status-out",{status:t})}var c=iina.menu,p=iina.sidebar;p.loadFile("dist/ui/window/index.html"),p.onMessage("getEndTime",function(){var e=n.getNumber("time-pos");p.postMessage("endTime",{time:e}),t.pause()}),p.onMessage("processVideoClip",function(i){!function(i,c,p){var u;(u=function(e,i){var c,p,u,f,g,h,d=arguments;return function(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){var c=[s,l];if(n)throw TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return o.label++,{value:c[1],done:!1};case 5:o.label++,r=c[1],c=[0];continue;case 7:c=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===c[0]||2===c[0])){o=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){o.label=c[1];break}if(6===c[0]&&o.label<i[1]){o.label=i[1],i=c;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(c);break}i[2]&&o.ops.pop(),o.trys.pop();continue}c=t.call(e,o)}catch(e){c=[6,e],r=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}}(this,function(v){switch(v.label){case 0:if(c=d.length>2&&void 0!==d[2]&&d[2],p=d.length>3&&void 0!==d[3]&&d[3],u=d.length>4?d[4]:void 0,f=d.length>5&&void 0!==d[5]?d[5]:o.get("ffmpeg_path"),!r.fileInPath(f))return[3,5];a.log(`ffmpeg found at ${o.get("ffmpeg_path")}, processing clip`),s("Processing ...","18px"),v.label=1;case 1:return v.trys.push([1,3,,4]),l(u,!0),[4,r.exec(f,[c&&"-hwaccel",c&&"videotoolbox","-i",n.getString("path"),"-ss",e,"-to",i,p&&"-vf",p&&"crop=w=ih*(9/16):h=ih:x=(iw-ow)/2:y=0,format=yuv420p",c&&"-c:v",c&&"h264_videotoolbox",c&&"-q:v",c&&"70",!c&&"-c:v",!c&&"libx264",!c&&"-crf",!c&&"23","-c:a","copy","-movflags","+faststart",`${n.getString("path").substring(0,n.getString("path").lastIndexOf("/"))}/${n.getString("filename").slice(0,n.getString("filename").lastIndexOf("."))}_clip.mov`].filter(Boolean))];case 2:return 0===(g=v.sent().status)?(l(u,!1),s("Clip saved in "+n.getString("path").substring(0,n.getString("path").lastIndexOf("/")),"18px"),u.hide(),t.resume()):s(`FFmpeg error code ${g}`,"18px",!0),[3,4];case 3:return h=v.sent(),s(`An error occured: ${h}`,"18px",!0),[3,4];case 4:return[3,6];case 5:s("ffmpeg not found","18px",!0),v.label=6;case 6:return[2]}})},function(){var t=this,n=arguments;return new Promise(function(r,i){var o=u.apply(t,n);function a(t){e(o,r,i,a,s,"next",t)}function s(t){e(o,r,i,a,s,"throw",t)}a(void 0)})}).apply(this,arguments)}(i.startPos,i.endPos,i.hwaccel,i.verticalCrop,p)}),p.onMessage("closeWindow",function(){p.hide()});var u=c.item("Start Clipping",function(){var e,t,i,a;p.show(),e=n.getNumber("time-pos"),p.postMessage("currentTime",{time:e}),i=null!=(t=o.get("ffmpeg_path"))?t:"ffmpeg",a=r.fileInPath(i),p.postMessage("is-ffmpeg-installed",{isInstalled:a})},{keyBinding:"Alt+Shift+r"});c.addItem(u)}();
//# sourceMappingURL=index.js.map
